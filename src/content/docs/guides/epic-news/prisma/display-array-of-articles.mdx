---
title: Load and display an array of articles
description: Learn how to use the map function to loop through an array of articles and display them on the page.
---

import MonsterReveal from "src/components/MonsterReveal.astro";

## Objectives

Now that we have loaded articles from the database, we can display them on the page.

In this guide, we will:

1. Create a reusable `ArticleCard` component from the code we have already written.
2. Loop through the mock articles using JavaScript's `map` function and display them on the page.
3. Load real articles from the database and display them on the page.

## Create a reusable `ArticleCard` component

In the previous guide, we created a `NewsCategoryPage` component that displays a single article. Let's refactor this component to create a reusable `ArticleCard` component.

:::note

You will now have your own code in the `NewsCategoryPage`, so don't worry about the code examples below being different.

What matters when creating a reusable component is that you can pass the elements that will change in each card as [**props**](https://react.dev/learn/passing-props-to-a-component), a topic that we have already covered in a [**previous tutorial**](/code-monster/guides/prisma/displaying-data).

:::

In this case, the `image`, `title`, and `category` of the article will become props, and the code highlighted below will become the basis of our new custom component:

```tsx title="app/routes/news.$category.tsx" collapse={2-6} mark={13-38} showLineNumbers
export default function NewsCategoryPage() {
	const { category, mockArticles } = useLoaderData<typeof loader>()

	console.log({ category, mockArticles })

	const { image, title, category: articleCategory } = mockArticles[0]

	return (
		<div className="container py-8 lg:py-16">
			<h2 className="mb-16 text-h2">{category}</h2>

			<div className="grid grid-cols-1 gap-6 md:grid-cols-4 xl:grid-cols-3">
				<div>
					<div className={`relative h-44 lg:h-52`}>
						<div className="absolute inset-0">
							<img
								className="h-full w-full object-cover"
								src={image}
								alt={title}
							/>
						</div>
					</div>
					<div
						className={`flex h-40 flex-col justify-between bg-card p-6 lg:h-44 dark:bg-dark-card`}
					>
						<h3
							className={`line-clamp-2 text-2xl font-bold text-foreground dark:text-dark-foreground`}
						>
							{title}
						</h3>
						<div className="flex items-center gap-3">
							<img src={techIcon} alt={category} className="h-6 w-6" />
							<span className="text-sm text-muted-foreground dark:text-dark-muted-foreground">
								{category}
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	)
}
```

Let's get started.

:::tip[Challenge]

### Challenge: build a reusable component

1. Using your knowledge of how components work from our [**previous tutorial**](/code-monster/guides/prisma/displaying-data), create a new component called `ArticleCard` that receives the following props:

		- `image` - this should be a `String`
		- `title` - this should be a `String`
		- `category` - this should be a `String`

		For the time being, create your new component somewhere inside the `app/routes/news.$category.tsx` file, and we will move it to a separate file later.

2. Remember that you will need to create an accompanying TypeScript [**interface**](/code-monster/guides/prisma/displaying-data#what-is-an-interface) describing the above props that the `ArticleCard` component should receive.

3. Pass the props to your new `ArticleCard` component in the `NewsCategoryPage` component where the old code used to be.

Once you've finished, compare your solution with the one below:

<MonsterReveal>

First, let's create the `ArticleCard` component together with an accompanying TypeScript interface:

```tsx title="app/routes/news.$category.tsx"
interface ArticleCardProps {
	image: string
	title: string
	category: string
}

function ArticleCard({ image, title, category }: ArticleCardProps) {
	return (
		<div>
			<div className={`relative h-44 lg:h-52`}>
				<div className="absolute inset-0">
					<img className="h-full w-full object-cover" src={image} alt={title} />
				</div>
			</div>
			<div
				className={`flex h-40 flex-col justify-between bg-card p-6 lg:h-44 dark:bg-dark-card`}
			>
				<h3
					className={`line-clamp-2 text-2xl font-bold text-foreground dark:text-dark-foreground`}
				>
					{title}
				</h3>
				<div className="flex items-center gap-3">
					<img src={techIcon} alt={category} className="h-6 w-6" />
					<span className="text-sm text-muted-foreground dark:text-dark-muted-foreground">
						{category.toUpperCase()}
					</span>
				</div>
			</div>
		</div>
	)
}
```

As you can see, all the code inside the `return` statement of the `ArticleCard` component is the same as the code we highlighted above in the `NewsCategoryPage` component. All that was needed was to cut and paste the code straight across.

Next, we can replace the old code in the `NewsCategoryPage` component with the new `ArticleCard` component, and pass it the props that it requires:

```diff lang="tsx" title="app/routes/news.$category.tsx" collapse={2-6}
export default function NewsCategoryPage() {
	const { category, mockArticles } = useLoaderData<typeof loader>()

	console.log({ category, mockArticles })

	const { image, title, category: articleCategory } = mockArticles[0]

	return (
		<div className="container py-8 lg:py-16">
			<h2 className="mb-16 text-h2">{category}</h2>

			<div className="grid grid-cols-1 gap-6 md:grid-cols-4 xl:grid-cols-3">
-				<div>
-					<div className={`relative h-44 lg:h-52`}>
-						<div className="absolute inset-0">
-							<img
-								className="h-full w-full object-cover"
-								src={image}
-								alt={title}
-							/>
-						</div>
-					</div>
-					<div
-						className={`flex h-40 flex-col justify-between bg-card p-6 lg:h-44 dark:bg-dark-card`}
-					>
-						<h3
-							className={`line-clamp-2 text-2xl font-bold text-foreground dark:text-dark-foreground`}
-						>
-							{title}
-						</h3>
-						<div className="flex items-center gap-3">
-							<img src={techIcon} alt={category} className="h-6 w-6" />
-							<span className="text-sm text-muted-foreground dark:text-dark-muted-foreground">
-								{category.toUpperCase()}
-							</span>
-						</div>
-					</div>
-				</div>
+				<ArticleCard title={title} category={articleCategory} image={image} />
			</div>
		</div>
	)
}
```
Not only is this code more readable (because having a component named `ArticleCard` makes it much easier to infer what the intention of the code is), but it also makes it easier to reuse the `ArticleCard` component in other parts of your application.

</MonsterReveal>

:::

## Displaying all mock articles

Now that we've got a reusable `ArticleCard` component, we can loop through all of the mock articles and display them on the page.

To do this, we will use JavaScript's `map` function to loop through the `mockArticles` array and render an `ArticleCard` component for each article.

:::tip[Challenge]

### Challenge: display all mock articles

We looked at how to use the `map` function in a [**previous tutorial**](/code-monster/guides/prisma/using-map), so if you need a refresher, feel free to check it out.

1. Inside the `NewsCategoryPage` component, replace the `ArticleCard` component with a `map` function that loops through the `mockArticles` array and renders an `ArticleCard` component for each article.
2. Pass the `image`, `title`, and `category` of each article as props to the `ArticleCard` component.
3. Use the `id` of each article as the `key` prop for the `ArticleCard` component inside the `map` function.

Your final result on screen should look something like this:

![Display all mock articles](src/assets/png/epic-news/display-all-mock-articles.png)

Once you've got a solution, compare it with the one below:

<MonsterReveal>

```diff lang="tsx" title="app/routes/news.$category.tsx" collapse={2-4, 8-31}
interface ArticleCardProps {
	image: string
	title: string
	category: string
}

function ArticleCard({ image, title, category }: ArticleCardProps) {
	return (
		<div>
			<div className={`relative h-44 lg:h-52`}>
				<div className="absolute inset-0">
					<img className="h-full w-full object-cover" src={image} alt={title} />
				</div>
			</div>
			<div
				className={`flex h-40 flex-col justify-between bg-card p-6 lg:h-44 dark:bg-dark-card`}
			>
				<h3
					className={`line-clamp-2 text-2xl font-bold text-foreground dark:text-dark-foreground`}
				>
					{title}
				</h3>
				<div className="flex items-center gap-3">
					<img src={techIcon} alt={category} className="h-6 w-6" />
					<span className="text-sm text-muted-foreground dark:text-dark-muted-foreground">
						{category.toUpperCase()}
					</span>
				</div>
			</div>
		</div>
	)
}

export default function NewsCategoryPage() {
	const { category, mockArticles } = useLoaderData<typeof loader>()

-	console.log({ category, mockArticles })
-
-	const { image, title, category: articleCategory } = mockArticles[0]
-
	return (
		<div className="container py-8 lg:py-16">
			<h2 className="mb-16 text-h2">{category}</h2>

			<div className="grid grid-cols-1 gap-6 md:grid-cols-4 xl:grid-cols-3">
-				<ArticleCard title={title} category={articleCategory} image={image} />
+				{mockArticles.map(({ id, title, category: articleCategory, image }) => {
+					return (
+						<ArticleCard
+							key={id}
+							title={title}
+							category={articleCategory}
+							image={image}
+						/>
+					)
+				})}
			</div>
		</div>
	)
}
```

</MonsterReveal>

:::

## Load real articles from the database

Now that we have successfully displayed all the mock articles on the page, we can replace the mock articles with real articles from the database.

To do this, we will use the `prisma` client to fetch all articles from the database and display them on the page.

### Remove mock articles

Let's start by removing the mock articles array from the `loader` function:

```diff lang="tsx" title="app/routes/news.$category.tsx" del=", mockArticles"
export async function loader({ params }: LoaderFunctionArgs) {
	const { category } = params

	invariant(typeof category === 'string', 'Category not found')

-	const mockArticles = Array.from({ length: 9 }).map((_, index) => {
-		const articleId = index + 1
-
-		return {
-			id: articleId,
-			title: `Article ${articleId}`,
-			category,
-			image: `https://picsum.photos/800/600`,
-		}
-	})

	return json({ category, mockArticles })
}

```

### Import the `prisma` client

Add an `import` to the `prisma` client at the top of the file:

```diff lang="tsx" title="app/routes/news.$category.tsx"
import { invariant } from '@epic-web/invariant'
import { json, type LoaderFunctionArgs } from '@remix-run/node'
import { useLoaderData } from '@remix-run/react'
import techIcon from '~/assets/png/news-categories/tech-logo@2x.png'
+import { prisma } from '~/utils/db.server.ts'
```

### Fetch all database articles

Next, let's fetch all articles from the database using the `prisma` client inside the `loader` function, and then export them as JSON:

```diff lang="tsx" title="app/routes/news.$category.tsx" ins=", allArticles" collapse={1-5}
import { invariant } from '@epic-web/invariant'
import { json, type LoaderFunctionArgs } from '@remix-run/node'
import { useLoaderData } from '@remix-run/react'
import techIcon from '~/assets/png/news-categories/tech-logo@2x.png'
import { prisma } from '~/utils/db.server.ts'

export async function loader({ params }: LoaderFunctionArgs) {
	const { category } = params

	invariant(typeof category === 'string', 'Category not found')

+	const allArticles = await prisma.article.findMany({
+		select: {
+			id: true,
+			title: true,
+			category: { select: { name: true } },
+			images: { select: { id: true } },
+		},
+	})

	return json({ category, allArticles })
}
```

:::note

### Understanding the `select` option

The `select` option is used to specify which fields from each record to include in the query result.

```tsx mark={2-6}
  const allArticles = await prisma.article.findMany({
    select: {
      id: true,
      title: true,
      category: { select: { name: true } },
      images: { select: { id: true } },
    },
  })
```

In this case, we are fetching the `id`, `title`, `category`, and `images` fields from the `article` table. We don't need the `content` of each article as this is an index page, so we are only fetching the fields that we need.

The `category` field is a relation to the `category` table, so we are fetching the `name` field from the `category` table.

Similarly, the `images` field is a relation to the `image` table, so we are fetching the `id` field from the `image` table.

:::

### Update article images

We are currently only fetching the `id` of each image from the database. To display the images on the page, we will need to generate a `src` for each image using a utility function from the Epic Stack.

The Epic Stack currently has a helper function for this called `getNoteImgSrc`. We need to update the function to work with articles.

Firstly, open the file `app/utils/misc.tsx` and update the entire function `getNoteImgSrc` inside here like so:

```diff lang="tsx" title="app/utils/misc.tsx" collapse={1-10}
import { useFormAction, useNavigation } from '@remix-run/react'
import { clsx, type ClassValue } from 'clsx'
import { useEffect, useMemo, useRef, useState } from 'react'
import { useSpinDelay } from 'spin-delay'
import { extendTailwindMerge } from 'tailwind-merge'
import { extendedTheme } from './tailwind/extended-theme.ts'

export function getUserImgSrc(imageId?: string | null) {
	return imageId ? `/resources/user-images/${imageId}` : '/img/user.png'
}

-export function getNoteImgSrc(imageId: string) {
-	return `/resources/note-images/${imageId}`
-}
+export function getArticleImgSrc(imageId: string) {
+	return `/resources/article-images/${imageId}`
+}

```

:::note[What is a resource route?]

### Understanding resource routes

If you look closely, this function is actually returning a string that represents a URL route:

```tsx file="app/utils/misc.tsx"
export function getArticleImgSrc(imageId: string) {
	return `/resources/article-images/${imageId}`
}
```

What is going on here? This is a special type of route called a **resource route**. A resource route is a route that returns a resource, such as an image, a file, or any other type of data that is not a specific user interface component.

Unlike the UI routes that we have been using so far, resource routes don't render an actual component on the screen, but can return any type of valid web response.

In this case, we are returning an image file directly from the database, via a **blob** - a "**b**inary **l**arge **ob**ject" that represents our image in binary.

You can read more about resource routes in the [**Remix documentation**](https://remix.run/docs/en/main/guides/resource-routes).

:::

Like any other route in Remix, this means we can locate the corresponding route file in the `app/routes` directory.

In this case, the file we need is called `app/routes/resources+/note-images.$imageId.tsx`.

Firstly, let's rename the file to `app/routes/resources+/article-images.$imageId.tsx`:

![Replace note images route](src/assets/png/epic-news/replace-note-image-route.png)

Next, lets update the code inside to reference `prisma.articleImage` instead of `prisma.noteImage`:

```diff lang="tsx" title="app/routes/resources+/article-image.$imageId.tsx" collapse={1-3, 13-22}
import { invariantResponse } from '@epic-web/invariant'
import { type LoaderFunctionArgs } from '@remix-run/node'
import { prisma } from '#app/utils/db.server.ts'

export async function loader({ params }: LoaderFunctionArgs) {
	invariantResponse(params.imageId, 'Image ID is required', { status: 400 })
-	const image = await prisma.noteImage.findUnique({
+	const image = await prisma.articleImage.findUnique({
		where: { id: params.imageId },
		select: { contentType: true, blob: true },
	})

	invariantResponse(image, 'Not found', { status: 404 })

	return new Response(image.blob, {
		headers: {
			'Content-Type': image.contentType,
			'Content-Length': Buffer.byteLength(image.blob).toString(),
			'Content-Disposition': `inline; filename="${params.imageId}"`,
			'Cache-Control': 'public, max-age=31536000, immutable',
		},
	})
}
```

### Display real articles on the page

Back inside `app/routes/news.$category.tsx`, we will need to import our new function to generate a `src` from our image id:

```diff lang="tsx" title="app/routes/news.$category.tsx" collapse={1-3}
import { invariant } from '@epic-web/invariant'
import { json, type LoaderFunctionArgs } from '@remix-run/node'
import { useLoaderData } from '@remix-run/react'
import techIcon from '~/assets/png/news-categories/tech-logo@2x.png'
import { prisma } from '~/utils/db.server.ts'
+import { getArticleImgSrc } from '~/utils/misc.tsx'
```

Finally, let's replace the `mockArticles` array with all the real articles from our database.

:::tip[Challenge]

Can you swap out the old `mockArticles` array with the new `allArticles` array yourself?

#### TIPS

1. Remember that `useLoaderData` will now return `allArticles` instead of `mockArticles`. Use `console.log` on the new `allArticles` array to see what it looks like in the browser console.
2. Use the `map` function to loop through the `allArticles` array and render an `ArticleCard` component for each article.
3. Remember to pass the `image` by calling the `getArticleImgSrc` function with the `id` of the first image in the `images` array as an argument.
4. If there is no image (because remember that images are optional for articles), you can use a placeholder image URL like `https://picsum.photos/800/600` instead.

		You could make use of a [**ternary operator**](https://www.codecademy.com/learn/introduction-to-javascript/modules/learn-javascript-control-flow/cheatsheet) for this.
5. Use the `id` of each article as the `key` prop for the `ArticleCard` component inside the `map` function.

If all goes well, your final news category index screen should look something like this:

![Display all articles](src/assets/png/epic-news/display-all-articles.png)

See if you can find a solution independently, and then compare it with the one below.

I've included all the changes in this file for reference.

<MonsterReveal>

```diff lang="tsx" title="app/routes/news.$category.tsx" ins=", allArticles" showLineNumbers collapse={1-3, 24-56}
import { invariant } from '@epic-web/invariant'
import { json, type LoaderFunctionArgs } from '@remix-run/node'
import { useLoaderData } from '@remix-run/react'
import techIcon from '~/assets/png/news-categories/tech-logo@2x.png'
import { prisma } from '~/utils/db.server.ts'
+import { getArticleImgSrc } from '~/utils/misc.tsx'

export async function loader({ params }: LoaderFunctionArgs) {
	const { category } = params

	invariant(typeof category === 'string', 'Category not found')

+	const allArticles = await prisma.article.findMany({
+		select: {
+			id: true,
+			title: true,
+			category: { select: { name: true } },
+			images: { select: { id: true } },
+		},
+	})

	return json({ category, allArticles })
}

interface ArticleCardProps {
	image: string
	title: string
	category: string
}

function ArticleCard({ image, title, category }: ArticleCardProps) {
	return (
		<div>
			<div className={`relative h-44 lg:h-52`}>
				<div className="absolute inset-0">
					<img className="h-full w-full object-cover" src={image} alt={title} />
				</div>
			</div>
			<div
				className={`flex h-40 flex-col justify-between bg-card p-6 lg:h-44 dark:bg-dark-card`}
			>
				<h3
					className={`line-clamp-2 text-2xl font-bold text-foreground dark:text-dark-foreground`}
				>
					{title}
				</h3>
				<div className="flex items-center gap-3">
					<img src={techIcon} alt={category} className="h-6 w-6" />
					<span className="text-sm text-muted-foreground dark:text-dark-muted-foreground">
						{category.toUpperCase()}
					</span>
				</div>
			</div>
		</div>
	)
}

export default function NewsCategoryPage() {
	const { category, allArticles } = useLoaderData<typeof loader>()

	return (
		<div className="container py-8 lg:py-16">
			<h2 className="mb-16 text-h2">{category}</h2>

			<div className="grid grid-cols-1 gap-6 md:grid-cols-4 xl:grid-cols-3">
+				{allArticles.map(({ id, title, category: articleCategory, images }) => {
+					const imageSrc = images[0]?.id
+						? getArticleImgSrc(images[0].id)
+						: 'https://picsum.photos/800/600'
+
+					return (
+						<ArticleCard
+							key={id}
+							title={title}
+							category={articleCategory?.name ?? 'Uncategorized'}
+							image={imageSrc}
+						/>
+					)
+				})}
			</div>
		</div>
	)
}
```

</MonsterReveal>

:::

## Summary

In this guide, we learned how to:

- Create a reusable `ArticleCard` component.
- Loop through an array of articles using JavaScript's `map` function and display them on the page.
- Load real articles from the database and display them on the page.
- Revise the `getNoteImgSrc` function into `getArticleImgSrc` to work with articles.
- Updated the `notes-images` resource route into `article-images`.

In the next guide, we will learn how to filter articles by the correct category.
